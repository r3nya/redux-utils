{"version":3,"sources":["reduxApiMiddleware.js"],"names":[],"mappings":"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","file":"reduxApiMiddleware.js","sourcesContent":["import { normalize, Schema } from 'normalizr';\nimport fetch from 'isomorphic-fetch';\nimport isPlainObject from 'lodash.isplainobject';\n\nclass ApiError extends Error {\n  constructor(status, statusText, response) {\n    super();\n    this.name = 'ApiError';\n    this.status = status;\n    this.statusText = statusText;\n    this.message = `${status} - ${statusText}`;\n    this.response = response;\n  }\n}\n\nfunction callApi(endpoint, method, headers, body, schema) {\n  const requestOptions = { method, body, headers }\n\n  return fetch(endpoint, requestOptions)\n    .then((response) => {\n      if (response.ok) {\n        return Promise.resolve(response);\n      } else {\n        return Promise.reject(response);\n      }\n    })\n    .then((response) => {\n      const contentType = response.headers.get('Content-Type');\n      if (contentType && ~contentType.indexOf('json')) {\n        return response.json().then((json) => {\n          if (schema) {\n            return Promise.resolve(normalize(json, schema));\n          } else {\n            return Promise.resolve(json);\n          }\n        });\n      } else {\n        return Promise.resolve();\n      }\n    },\n    (response) => {\n      const contentType = response.headers.get('Content-Type');\n      if (contentType && ~contentType.indexOf('json')) {\n        return response.json().then((json) => {\n          return Promise.reject(new ApiError(response.status, response.statusText, json));\n        });\n      } else {\n        return Promise.reject(new ApiError(response.status, response.statusText, response));\n      }\n    });\n}\n\nexport const CALL_API = 'Call API'\n\nexport function isRSAA(action) {\n  const validRootKeys = [\n    [CALL_API],\n    'payload',\n    'meta'\n  ];\n  const validCallAPIKeys = [\n    'endpoint',\n    'method',\n    'types',\n    'body',\n    'headers',\n    'schema',\n    'bailout'\n  ];\n  const validMethods = [\n    'GET',\n    'HEAD',\n    'POST',\n    'PUT',\n    'PATCH',\n    'DELETE',\n    'OPTIONS'\n  ]\n\n  const callAPI = action[CALL_API];\n  if (!isPlainObject(action) || typeof callAPI === 'undefined') {\n    return false;\n  }\n\n  const { endpoint, method, body, headers, schema, types, bailout } = callAPI;\n\n  return Object.keys(action).every((key) => ~validRootKeys.indexOf(key)) &&\n    isPlainObject(callAPI) &&\n    Object.keys(callAPI).every((key) => ~validCallAPIKeys.indexOf(key)) &&\n    (typeof endpoint === 'string' || typeof endpoint === 'function') &&\n    ~validMethods.indexOf(method.toUpperCase()) &&\n    (Array.isArray(types) && types.length === 3) &&\n    (typeof headers === 'undefined' || isPlainObject(headers)) &&\n    (typeof schema === 'undefined' || schema instanceof Schema || schema.hasOwnProperty('_itemSchema')) &&\n    (typeof bailout === 'undefined' || typeof bailout === 'boolean' || typeof bailout === 'function');\n}\n\nexport function apiMiddleware({ getState }) {\n  return (next) => (action) => {\n    const callAPI = action[CALL_API];\n    if (!isRSAA(action)) {\n      return next(action);\n    }\n\n    let { endpoint } = callAPI;\n    const { method, body, headers, schema, types, bailout } = callAPI;\n    if (typeof endpoint === 'function') {\n      endpoint = endpoint(getState());\n    }\n    if ((typeof bailout === 'boolean' && bailout) ||\n        (typeof bailout === 'function' && bailout(getState()))) {\n      return Promise.resolve('Bailing out');\n    }\n\n    function actionWith(data, payload) {\n      const finalPayload = { ...action.payload, ...payload };\n      const finalAction = { ...action, payload: finalPayload, ...data };\n      delete finalAction[CALL_API];\n      return finalAction;\n    }\n\n    const [requestType, successType, failureType] = types;\n    next(actionWith({ type: requestType }));\n\n    return callApi(endpoint, method, headers, body, schema).then(\n      (response) => next(actionWith({ type: successType }, response)),\n      (error) => next(actionWith({\n        type: failureType,\n        payload: error,\n        error: true\n      }))\n    );\n  };\n}\n"],"sourceRoot":"/source/"}